<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=El+Messiri:wght@700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'El Messiri', sans-serif !important; }
        body { background: #000; overflow: hidden; }
        #game-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; border: none; z-index: 1; }

        #prediction-panel {
            position: fixed; top: 5px; left: 50%; transform: translateX(-50%);
            width: 96%; max-width: 380px; 
            background: rgba(255, 255, 255, 0.98);
            border-radius: 8px; padding: 6px 10px; z-index: 10000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.6);
            text-align: center; border-bottom: 4px solid #ce93d8;
        }

        .pulse-anim { animation: pulse-glow 0.7s ease-out; }
        @keyframes pulse-glow {
            0% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.02); box-shadow: 0 0 15px #ce93d8; }
            100% { transform: translateX(-50%) scale(1); }
        }

        .header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .title-pill { background: linear-gradient(90deg, #6a1b9a, #9c27b0); color: #fff; padding: 2px 12px; border-radius: 5px; font-size: 10px; font-weight: 700; }
        .per-info { font-size: 11px; font-weight: bold; color: #4a148c; background: #f3e5f5; padding: 1px 6px; border-radius: 4px; border: 1px solid #e1bee7; }

        .grid-3 { display: grid; grid-template-columns: 1.2fr 1fr 1fr; gap: 8px; margin-bottom: 6px; }
        .grid-3 label { font-size: 9px; color: #7b1fa2; font-weight: bold; display: block; margin-bottom: 2px; text-transform: uppercase; }
        
        input { 
            width: 100%; padding: 0 4px; border-radius: 4px; 
            border: 1.5px solid #ce93d8; 
            text-align: center; font-size: 14px; font-weight: bold; 
            outline: none; height: 26px; background: #fff; color: #4a148c;
        }

        .res-row {
            display: grid; grid-template-columns: 1.1fr 0.9fr 1.4fr; gap: 6px;
            background: #f8f1f9; padding: 6px; border-radius: 6px; align-items: center;
        }
        .res-item { display: flex; flex-direction: column; align-items: center; }
        .small-l { font-size: 8px; color: #9c27b0; font-weight: bold; }
        
        #next-bet { font-size: 18px; font-weight: 900; }
        #bet-amt { font-size: 16px; color: #4a148c; font-weight: bold; }

        .btn-row { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; }
        .btn { padding: 5px; border: none; border-radius: 4px; font-size: 9px; font-weight: bold; color: #fff; cursor: pointer; text-transform: uppercase; }
        #startBtn { background: #4a148c; grid-column: span 2; margin-bottom: 3px; font-size: 11px; }
        #saveBtn { background: #ab47bc; } #stopBtn { background: #757575; }
    </style>
</head>
<body>

    <iframe src="https://jalwagame.com" id="game-bg"></iframe>

    <div id="prediction-panel">
        <div class="header-row">
            <div class="title-pill">MADARA ASURA ENGINE</div>
            <div class="per-info" id="perShow">PERIOD: ----</div>
        </div>

        <div class="grid-3">
            <div><label>Wallet</label><input type="number" id="walletInp" value="0"></div>
            <div><label>Base</label><input type="number" id="baseInp" value="10"></div>
            <div><label>Mul</label><input type="text" id="mulVal" value="2x"></div>
        </div>

        <div class="res-row">
            <div class="res-item"><span class="small-l">SIGNAL</span><span id="next-bet">---</span></div>
            <div class="res-item"><span class="small-l">BET ₹</span><span id="bet-amt">₹0</span></div>
            <div class="btn-row">
                <button class="btn" id="startBtn" onclick="startEngine()">START ENGINE</button>
                <button class="btn" id="saveBtn" onclick="saveData()">SAVE</button>
                <button class="btn" id="stopBtn" onclick="stopEngine()">STOP</button>
            </div>
        </div>
    </div>

    <script>
        let running = false;
        let lastId = "";
        let prediction = "SKIP";
        let currentAmt = 0;
        const multipliers = [5, 4, 3, 2, 1];

        function saveData() {
            localStorage.setItem('asura_config', JSON.stringify({
                wallet: document.getElementById('walletInp').value,
                base: document.getElementById('baseInp').value,
                mul: document.getElementById('mulVal').value
            }));
            alert("Settings Saved!");
        }

        window.onload = () => {
            const saved = localStorage.getItem('asura_config');
            if(saved) {
                const d = JSON.parse(saved);
                document.getElementById('walletInp').value = d.wallet;
                document.getElementById('baseInp').value = d.base;
                document.getElementById('mulVal').value = d.mul;
            }
        };

        async function fetchHistory() {
            try {
                const r = await fetch('https://draw.ar-lottery01.com/WinGo/WinGo_1M/GetHistoryIssuePage.json');
                const d = await r.json();
                return d.data.list;
            } catch(e) { return null; }
        }

        async function engine() {
            if(!running) return;
            const history = await fetchHistory();
            if(!history || history.length < 5) { setTimeout(engine, 2000); return; }

            const latest = history[0];
            const wInp = document.getElementById('walletInp');
            let wVal = parseFloat(wInp.value) || 0;

            if(latest.issueNumber !== lastId) {
                const panel = document.getElementById('prediction-panel');
                panel.classList.remove('pulse-anim');
                void panel.offsetWidth;
                panel.classList.add('pulse-anim');

                if(lastId !== "" && prediction !== "SKIP") {
                    const actualResult = (parseInt(latest.number) <= 4) ? "SMALL" : "BIG";
                    if(prediction === actualResult) {
                        wVal += (currentAmt * 0.98);
                        currentAmt = parseFloat(document.getElementById('baseInp').value);
                    } else {
                        wVal -= currentAmt;
                        let m = parseFloat(document.getElementById('mulVal').value.replace('x','')) || 2;
                        currentAmt *= m;
                    }
                    wInp.value = wVal.toFixed(2);
                }

                lastId = latest.issueNumber;
                document.getElementById('perShow').innerText = "PERIOD: " + (BigInt(lastId) + 1n).toString().slice(-4);

                let last5 = history.slice(0, 5).reverse();
                let dataPoints = last5.map(x => (parseInt(x.number) > 4 ? 1 : 0));
                let weightedSum = dataPoints.reduce((sum, val, i) => sum + (val * multipliers[i]), 0);
                let score = weightedSum / 15;

                const nextBetEl = document.getElementById('next-bet');
                const betAmtEl = document.getElementById('bet-amt');
                
                // Logic Filter for 0.6, 0.7, 0.8...
                if(score >= 0.6) {
                    prediction = "BIG";
                    nextBetEl.style.color = "#7b1fa2"; // Original Purple
                } else if(score <= 0.4) {
                    prediction = "SMALL";
                    nextBetEl.style.color = "#00d2ff"; // Light Blue
                } else {
                    prediction = "SKIP";
                }

                if(prediction === "SKIP") {
                    nextBetEl.innerText = "SKIP";
                    nextBetEl.style.color = "#888";
                    betAmtEl.innerText = "₹0";
                } else {
                    if(currentAmt === 0) currentAmt = parseFloat(document.getElementById('baseInp').value);
                    nextBetEl.innerText = prediction;
                    betAmtEl.innerText = "₹" + Math.floor(currentAmt);
                }
            }
            setTimeout(engine, 3000);
        }

        function startEngine() { 
            running = true; 
            document.getElementById('startBtn').innerText = "ENGINE ACTIVE";
            document.getElementById('startBtn').style.background = "#2e7d32";
            engine(); 
        }
        function stopEngine() { 
            running = false; 
            document.getElementById('startBtn').innerText = "START ENGINE";
            document.getElementById('startBtn').style.background = "#4a148c";
            document.getElementById('next-bet').innerText = "STOPPED";
            document.getElementById('next-bet').style.color = "#888";
        }
    </script>
</body>
</html>
